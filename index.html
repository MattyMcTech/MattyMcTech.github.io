<!DOCTYPE html>
<html lang="en">
<head>
    <base href="https://pixelconquest.world/">
    <title>PixelConquest: Global Domination</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        /* ... (keep the existing styles) ... */
        
        /* Mobile-specific styles */
        @media (max-width: 768px) {
            .container {
                padding: 0;
                overflow: hidden;
                width: 100vw;
                height: calc(100vh - 100px);
            }
            .grid-wrapper {
                padding: 0;
                border: none;
                background-image: none;
                overflow: auto;
                width: 100%;
                height: 100%;
            }
            .grid {
                grid-template-columns: repeat(50, 20vw);
                gap: 0;
                width: 1000vw;
                height: 1000vw;
            }
            .cell {
                width: 20vw;
                height: 20vw;
                border: 1px solid #34495e;
            }
            #mobileControls {
                display: flex;
                justify-content: space-around;
                width: 100%;
                position: fixed;
                bottom: 20px;
            }
            #mobileControls button {
                background-color: #e74c3c;
                color: #ecf0f1;
                border: none;
                padding: 10px 20px;
                font-size: 16px;
                border-radius: 5px;
                cursor: pointer;
            }
        }
    </style>
</head>
<body>
    <h1>PixelConquest: Global Domination</h1>
    <div class="container">
        <div class="grid-wrapper">
            <div class="grid" id="pixelGrid"></div>
        </div>
    </div>
    <div id="status" class="pulse">Identifying your strategic position...</div>
    <div id="mobileControls" style="display: none;">
        <button id="zoomIn">Zoom In</button>
        <button id="zoomOut">Zoom Out</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/gun/gun.js"></script>
    <script>
        const gun = Gun(['https://gun-manhattan.herokuapp.com/gun']);
        const grid = document.getElementById('pixelGrid');
        const statusEl = document.getElementById('status');
        let userCountry = '';
        let isMobile = window.innerWidth <= 768;
        let currentZoom = 1;

        const countryNames = {
            'US': 'United States',
            'GB': 'United Kingdom',
            'FR': 'France',
            'DE': 'Germany',
            'IT': 'Italy',
            'ES': 'Spain',
            'CA': 'Canada',
            'AU': 'Australia',
            'JP': 'Japan',
            'KR': 'South Korea',
            // Add more country codes and names as needed
        };

        function createGrid() {
            for (let i = 0; i < 2500; i++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                const input = document.createElement('input');
                input.type = 'checkbox';
                input.id = `cell-${i}`;
                const label = document.createElement('label');
                label.htmlFor = `cell-${i}`;
                const tooltip = document.createElement('span');
                tooltip.className = 'tooltip';
                cell.appendChild(input);
                cell.appendChild(label);
                cell.appendChild(tooltip);
                grid.appendChild(cell);

                input.addEventListener('change', function() {
                    updateCell(i, this.checked);
                });

                // Load existing data
                gun.get('pixels').get(i).on(updateCellDisplay);
            }
        }

        function updateCell(index, isChecked) {
            if (isChecked) {
                gun.get('pixels').get(index).put({country: userCountry, conquered: true});
            } else {
                gun.get('pixels').get(index).put({country: null, conquered: false});
            }
        }

        function updateCellDisplay(data) {
            const index = this._.get;
            const cell = document.getElementById(`cell-${index}`);
            const input = cell.querySelector('input');
            const label = cell.querySelector('label');
            const tooltip = cell.querySelector('.tooltip');

            if (data && data.conquered) {
                input.checked = true;
                label.innerHTML = `<div class="flag" style="background-image: url('https://flagcdn.com/w20/${data.country.toLowerCase()}.png')"></div>`;
                tooltip.textContent = countryNames[data.country] || data.country;
            } else {
                input.checked = false;
                label.innerHTML = '';
                tooltip.textContent = '';
            }
        }

        function getUserLocation() {
            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    const latitude = position.coords.latitude;
                    const longitude = position.coords.longitude;
                    fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${latitude}&longitude=${longitude}&localityLanguage=en`)
                        .then(response => response.json())
                        .then(data => {
                            userCountry = data.countryCode;
                            statusEl.textContent = `Commander from ${data.countryName}! Your mission: Conquer the pixel world!`;
                            statusEl.classList.remove('pulse');
                        })
                        .catch(error => {
                            console.error("Error fetching country data:", error);
                            statusEl.textContent = "Intel compromised. Proceed with caution, anonymous commander!";
                            statusEl.classList.remove('pulse');
                        });
                }, function(error) {
                    console.error("Error getting user location:", error);
                    statusEl.textContent = "Location classified. Operate as an anonymous commander!";
                    statusEl.classList.remove('pulse');
                });
            } else {
                statusEl.textContent = "Geolocation unavailable. Commence anonymous operations!";
                statusEl.classList.remove('pulse');
            }
        }

        function setupMobileControls() {
            const mobileControls = document.getElementById('mobileControls');
            const zoomInBtn = document.getElementById('zoomIn');
            const zoomOutBtn = document.getElementById('zoomOut');

            if (isMobile) {
                mobileControls.style.display = 'flex';
                
                zoomInBtn.addEventListener('click', () => {
                    currentZoom = Math.min(currentZoom + 0.1, 2);
                    updateGridZoom();
                });

                zoomOutBtn.addEventListener('click', () => {
                    currentZoom = Math.max(currentZoom - 0.1, 0.5);
                    updateGridZoom();
                });

                setupTouchEvents();
            }
        }

        function updateGridZoom() {
            grid.style.transform = `scale(${currentZoom})`;
        }

        function setupTouchEvents() {
            let isDragging = false;
            let startX, startY, scrollLeft, scrollTop;
            const gridWrapper = document.querySelector('.grid-wrapper');

            gridWrapper.addEventListener('touchstart', (e) => {
                isDragging = true;
                startX = e.touches[0].pageX - gridWrapper.offsetLeft;
                startY = e.touches[0].pageY - gridWrapper.offsetTop;
                scrollLeft = gridWrapper.scrollLeft;
                scrollTop = gridWrapper.scrollTop;
            });

            gridWrapper.addEventListener('touchend', () => {
                isDragging = false;
            });

            gridWrapper.addEventListener('touchmove', (e) => {
                if (!isDragging) return;
                e.preventDefault();
                const x = e.touches[0].pageX - gridWrapper.offsetLeft;
                const y = e.touches[0].pageY - gridWrapper.offsetTop;
                const walkX = (x - startX) * 2;
                const walkY = (y - startY) * 2;
                gridWrapper.scrollLeft = scrollLeft - walkX;
                gridWrapper.scrollTop = scrollTop - walkY;
            });
        }

        createGrid();
        getUserLocation();
        setupMobileControls();

        window.addEventListener('resize', () => {
            isMobile = window.innerWidth <= 768;
            setupMobileControls();
        });
    </script>
</body>
</html>
